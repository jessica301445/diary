<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ‰‹å¸³æ—¥è¨˜ - æ‰‹æ©Ÿå„ªåŒ–ç‰ˆ</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    /* æ ¸å¿ƒæ¨£å¼ - ä¿ç•™åŸç‰ˆé¢¨æ ¼ */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      font-family: Georgia, "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", serif;
      color: #5D4037;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .book-container {
      perspective: 1200px;
      width: 900px;
      height: 650px;
      position: relative;
    }

    .book {
      width: 100%; height: 100%;
      position: relative;
      transform-style: preserve-3d;
      background: #8B4513;
      border-radius: 20px;
      box-shadow: 0 40px 80px rgba(0,0,0,0.5);
    }

    .book-spine {
      position: absolute; left: 50%; top: 0; width: 5mm; height: 100%;
      background: linear-gradient(to right, #654321 0%, #8B4513 50%, #654321 100%);
      z-index: 50; transform: translateX(-50%);
    }

    .page {
      position: absolute; width: 50%; height: 100%;
      padding: 50px 45px; padding-bottom: 130px;
      background: white; overflow-y: auto;
      line-height: 1.8; font-size: 16px;
      background-image: repeating-linear-gradient(0deg, transparent, transparent 24px, #f5f5f5 24px, #f5f5f5 25px);
      box-shadow: inset 5px 0 10px rgba(0,0,0,0.1);
      word-wrap: break-word;
    }

    .page.left { left: 0; border-radius: 20px 0 0 20px; }
    .page.right { right: 0; border-radius: 0 20px 20px 0; }

    .page-header {
      display: flex; justify-content: space-between; align-items: center;
      font-weight: bold; color: #5D4037; font-size: 20px;
      margin-bottom: 20px; padding-bottom: 12px; border-bottom: 3px solid #D4AF37;
    }

    .entry-actions { position: absolute; top: 15px; right: 15px; z-index: 100; }
    .entry-actions button {
      background: #4CAF50; color: white; border: none; padding: 4px 10px;
      margin-left: 5px; border-radius: 12px; cursor: pointer; font-size: 12px;
    }
    .entry-actions .delete { background: #f44336; }

    /* æ§åˆ¶åˆ— - é›»è…¦ç‰ˆ */
    .controls {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(255,255,255,0.95); padding: 10px 20px; border-radius: 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 5000;
      display: flex; align-items: center; gap: 10px;
    }

    .controls button {
      background: linear-gradient(145deg, #FF9800, #F57C00); border: none; color: white;
      padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; font-size: 14px;
    }

    /* === æ‰‹æ©Ÿç«¯å„ªåŒ–ä¿®æ­£ === */
    @media (max-width: 768px) {
      .book-container { width: 100vw; height: 90vh; }
      .book-spine { display: none !important; } /* éš±è—æ›¸è„Š */
      .page { width: 100% !important; border-radius: 20px !important; padding: 30px 20px !important; }
      .page.right { display: none !important; } /* åƒ…é¡¯ç¤ºå–®é  */
      
      .controls {
        bottom: 0; width: 100%; border-radius: 0; height: 10%; /* ä½”æ¯” 10% */
        padding: 5px; gap: 5px; justify-content: space-around;
      }
      .controls button { padding: 6px 10px; font-size: 12px; flex: 1; max-width: 80px; text-align: center; }
      #pageCounter { font-size: 12px; min-width: 60px; text-align: center; }
      
      .page-header { font-size: 18px; }
    }

    /* å½ˆçª—æ¨£å¼ */
    .entry-modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); z-index: 6000; justify-content: center; align-items: center;
    }
    .modal-content {
      background: #fffdf9; padding: 25px; border-radius: 20px;
      width: 90%; max-width: 500px; border: 3px solid #8B4513;
    }
    .modal-content textarea { width: 100%; height: 150px; margin: 10px 0; padding: 10px; }
  </style>
</head>

<body>
  <div class="book-container">
    <div class="book" id="book">
      <div class="book-spine" id="spine"></div>
      <div class="page left" id="leftPage"></div>
      <div class="page right" id="rightPage"></div>
    </div>
  </div>

  <div class="controls">
    <button onclick="prevPage()">â¬…ï¸ä¸Šä¸€é </button>
    <span id="pageCounter">å°é¢</span>
    <button onclick="showNewEntryModal()">âœï¸æ–°å¢</button>
    <button onclick="exportPDF()">ğŸ“„PDF</button>
    <button onclick="nextPage()">ä¸‹ä¸€é â¡ï¸</button>
  </div>

  <div id="passwordModal" class="entry-modal">
    <div class="modal-content" style="max-width: 300px; text-align: center;">
      <h3>è«‹è¼¸å…¥å¯†ç¢¼</h3>
      <input type="password" id="passwordInput" style="width:100%; padding:10px; margin:15px 0; text-align:center;">
      <button onclick="checkPassword()" style="background:#4CAF50; color:white; padding:8px 20px; border:none; border-radius:15px;">ç¢ºèª</button>
    </div>
  </div>

  <div id="entryModal" class="entry-modal">
    <div class="modal-content">
      <h3 id="modalTitle">æ’°å¯«æ‰‹å¸³</h3>
      <input id="modalDate" type="date" style="width:100%; padding:8px; margin-top:10px;">
      <textarea id="modalEntry" placeholder="ä»Šå¤©ç™¼ç”Ÿäº†ä»€éº¼äº‹ï¼Ÿ"></textarea>
      <div style="text-align: center;">
        <button onclick="cancelEdit()" style="padding:8px 20px; margin-right:10px;">å–æ¶ˆ</button>
        <button onclick="saveEntry()" style="background:#4CAF50; color:white; padding:8px 20px; border:none; border-radius:15px;">å„²å­˜</button>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'handbookEntries';
    const DIARY_PASSWORD = '0000'; 
    let entries = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    let currentPage = 0, viewMode = 'cover', isAuthenticated = false;

    // åˆ¤æ–·æ˜¯å¦ç‚ºæ‰‹æ©Ÿç«¯
    const isMobile = () => window.innerWidth <= 768;

    function renderPage(){
      const book = document.getElementById('book'), left = document.getElementById('leftPage'), right = document.getElementById('rightPage');
      const mobile = isMobile();
      
      if (viewMode === 'cover'){
        book.style.background = '#8B4513';
        left.className = 'page left cover';
        left.innerHTML = `<div style="height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white;"><h1>æ‰‹å¸³æ—¥è¨˜</h1><p>My Diary</p></div>`;
        right.style.display = 'none';
      } else {
        book.style.background = 'white';
        left.className = 'page left';
        left.innerHTML = getPageHtml(currentPage);
        
        if (mobile) {
          right.style.display = 'none';
        } else {
          right.style.display = 'block';
          right.innerHTML = getPageHtml(currentPage + 1);
        }
      }
      updateNavButtons();
    }

    function getPageHtml(idx){
      if (idx < 0 || idx >= entries.length) return `<div style="text-align:center; margin-top:100px; color:#ccc;">ç©ºç™½é </div>`;
      const item = entries[idx];
      return `
        <div class="entry-actions">
          <button onclick="editEntry(${idx})">ç·¨è¼¯</button>
          <button class="delete" onclick="deleteEntry(${idx})">åˆªé™¤</button>
        </div>
        <div class="page-header"><span>${item.date.replaceAll('-','/')}</span></div>
        <div style="white-space:pre-wrap;">${item.text}</div>
      `;
    }

    function nextPage(){
      if(viewMode === 'cover') {
        if(!isAuthenticated) { document.getElementById('passwordModal').style.display='flex'; return; }
        viewMode = 'content'; currentPage = 0; renderPage(); return;
      }
      const step = isMobile() ? 1 : 2;
      if(currentPage + step < entries.length) { currentPage += step; renderPage(); }
    }

    function prevPage(){
      const step = isMobile() ? 1 : 2;
      if(currentPage - step < 0) { viewMode = 'cover'; renderPage(); return; }
      currentPage -= step; renderPage();
    }

    function updateNavButtons(){
      const counter = document.getElementById('pageCounter');
      if(viewMode === 'cover') counter.textContent = 'å°é¢';
      else counter.textContent = isMobile() ? `${currentPage + 1}/${entries.length}` : `${currentPage + 1}-${Math.min(currentPage + 2, entries.length)}/${entries.length}`;
    }

    function checkPassword(){
      if(document.getElementById('passwordInput').value === DIARY_PASSWORD){
        isAuthenticated = true; document.getElementById('passwordModal').style.display='none';
        viewMode = 'content'; renderPage();
      } else { alert("å¯†ç¢¼éŒ¯èª¤"); }
    }

    function showNewEntryModal(){
        document.getElementById('modalEntry').value = "";
        document.getElementById('modalDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('entryModal').style.display = 'flex';
    }

    function saveEntry(){
      const text = document.getElementById('modalEntry').value, date = document.getElementById('modalDate').value;
      if(!text) return;
      entries.unshift({text, date});
      localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
      document.getElementById('entryModal').style.display = 'none';
      renderPage();
    }

    function cancelEdit(){ document.getElementById('entryModal').style.display = 'none'; }
    function deleteEntry(idx){ if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')){ entries.splice(idx,1); localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); renderPage(); } }

    window.onload = renderPage;
    window.onresize = renderPage;
  </script>
</body>
</html>